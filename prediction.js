  
    // Load the Teachable Machine model
    async function loadModel() {
        const model = await tf.loadLayersModel('teacheable/model.json');
    return model;
  }

      // Preprocess the input image
      function preprocessImage(image) {
        // Resize the image to match the input shape of the model
        const resizedImage = tf.image.resizeBilinear(image, [224, 224]);

    // Normalize the pixel values between -1 and 1
    const normalizedImage = resizedImage.div(255).sub(0.5).mul(2);

    // Expand the dimensions to match the input shape of the model
    const batchedImage = normalizedImage.expandDims(0);

    return batchedImage;
  }

    // Make predictions with the model
      async function predict() {
        const imageInput = document.getElementById('images');
    const image = await loadImage(imageInput.files[0]);
    const preprocessedImage = preprocessImage(image);

    const model = await loadModel();
    const predictions = model.predict(preprocessedImage);
    const predictedLabel = predictions.argMax(1).dataSync()[0];

    console.log('Predicted Label:', predictedLabel);

        // mapping as per your label classes(butang og data base sa class)
        const labelMap = {0: {name: 'Apple', 
                          disease: 'Scab',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      1: {name: 'Apple',
                          disease: 'Black Rot',
                          description: 'Black root rot, also called dead manâ€™s fingers or Xylaria root rot, is occasionally observed on mature apple and cherry trees. Although trees of all ages can be infected, most trees that die from black root rot are at least 10 years old.',
                          effects:'Black rot can reduce the yield of apple trees and make the fruit unmarketable. It can also weaken the tree, making it more susceptible to other diseases and pests.', 
                          cause:'Black rot is caused by the fungus Botryosphaeria obtusa. The fungus can survive in dead tissue on the tree or in the soil. It is spread by wind, rain, and insects.', 
                          medicine: 'There are no commercial fungicides that are specifically labeled for the control of black rot. However, some general-purpose fungicides can be effective.', 
                          prevention:'Planting resistant varieties, Pruning to remove dead or diseased tissue, and Applying a fungicide before the onset of the growing season.',
                          link:'https://www.ontario.ca/page/black-rot#:~:text=Black%20rot%20is%20an%20important,for%20nearby%20younger%20bearing%20blocks',
                         },
                      2:{name: 'Apple', 
                          disease: 'No disease detected(Healthy Plant)',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      3:{name: 'Blueberry', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      4:{name: 'Cherry', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      5:{name: 'Cherry', 
                          disease: 'Powdery Mildew',
                          description: 'Cherry powdery mildew is brought on by Podosphaera clandestina, a fungus. Powdery mildew shows as white, powdery, or felt-like fungal growth in areas on leaves. It can distort the affected plant parts and cause them to become stunted or deformed.',
                          effects:'Cherry trees can suffer from powdery mildew, which decreases their vitality, development, and general output. Premature leaf drop from infected plants might result in less photosynthesis and poorer fruit quality. Fruit that has been severely harmed may develop cracks or distortions that make it unfit for market or consumption.', 
                          cause:'Cherry tree powdery mildew is brought on by fungi, particularly Podosphaera and Blumeria species. These fungus prefer warm, humid weather, which they frequently encounter in the spring and early summer. High humidity levels, congested tree canopies, and poor ventilation can all promote the growth and spread of disease.',
                          medicine: 'For the management of powdery mildew on cherry trees, fungicides are readily accessible on the market. Fungicides like sulfur, myclobutanil, and propiconazole are frequently applied. To use fungicides safely and effectively, it is crucial to carefully read and adhere to the instructions on the product labels as well as take into account any regional rules or recommendations.', 
                          prevention:'Reduce humidity and enhance airflow by pruning and thinning the canopy, which can thwart the growth of illness.  Apply fungicides preventively, especially during times of strong disease pressure or when the environment is conducive to the growth of powdery mildew. If at all possible, avoid overhead irrigation since moist foliage might encourage the growth of powdery mildew. Instead, to keep the roots moist without wetting the foliage, utilize drip watering or soaker hose irrigation.',
                          link:'https://www.bctfpg.ca/pest_guide/info/101/Powdery_Mildew_Sweet_Cherries#:~:text=General%20Description,by%20the%20fungus%20Podosphaera%20clandestina.&text=On%20leaves%2C%20powdery%20mildew%20appears,often%20puckered%20or%20distorted%20',
                         },
                      6:{name: 'Corn', 
                          disease: 'Cercos Pora',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      7:{name: 'Corn', 
                          disease: 'Common Rust',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      8:{name: 'Corn', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      9:{name: 'Corn', 
                          disease: 'Northern Leaf Blight',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      10:{name: 'Grape', 
                          disease: 'Black Rot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      11:{name: 'Grape', 
                          disease: 'Black Measles',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      12:{name: 'Grape', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      13:{name: 'Grape', 
                          disease: 'Isariopsis Leaf Spot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      14:{name: 'Orange', 
                          disease: 'Haunglongbing',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      15:{name: 'Peach', 
                          disease: 'Bacterial Spot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      16:{name: 'Peach', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      17:{name: 'Pepper', 
                          disease: 'Bacterial Spot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      18:{name: 'Pepper', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      19:{name: 'Potato', 
                          disease: 'Early Blight',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      20:{name: 'Raspberry', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      21:{name: 'Soybean', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      22:{name: 'Squash', 
                          disease: 'Powdery Mildew',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      23:{name: 'Strawberry', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      24:{name: 'Strawberry', 
                          disease: 'Leaf Scorch',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      25:{name: 'Tomato', 
                          disease: 'Bacterial Spot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      26:{name: 'Tomato', 
                          disease: 'Early Blight',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      27:{name: 'Tomato', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      28:{name: 'Tomato', 
                          disease: 'Late Blight',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      29:{name: 'Tomato', 
                          disease: 'Leaf Mold',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      30:{name: 'Tomato', 
                          disease: 'Septoria Leaf Spot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      31:{name: 'Tomato', 
                          disease: 'Spider Mites',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      32:{name: 'Tomato', 
                          disease: 'Target Spot',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      33:{name: 'Tomato', 
                          disease: 'Mosaic Virus',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      34:{name: 'Tomato', 
                          disease: 'Yellow Leaf Curl Virus',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      35:{name: 'Apple', 
                          disease: 'Cedar Rust',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      36:{name: 'Potato', 
                          disease: 'Healthy',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      37:{name: 'Potato', 
                          disease: 'Late Blight',
                          description: '',
                          effects:'', 
                          cause:'',
                          medicine: '', 
                          prevention:'',
                          link:'',
                         },
                      };

          //variable for prediction
          // const predictedWord = labelMap[predictedLabel].name;
          // console.log('predictedWord:', predictedWord);
          const predictedName = labelMap[predictedLabel].name;
          const predictedDisease = labelMap[predictedLabel].disease;
          const predictedDescription = labelMap[predictedLabel].description;
          const predictedeffects = labelMap[predictedLabel].effects;
          const predictedcause = labelMap[predictedLabel].cause;
          const predictedmedicine = labelMap[predictedLabel].medicine;
          const predictedprevention = labelMap[predictedLabel].prevention;
          const predictedlink = labelMap[predictedLabel].link;
          console.log('predictedName:', predictedName);
          console.log('predictedDisease:', predictedDisease);
          console.log('predictedDescription:', predictedDescription);
          console.log('predictedeffects:', predictedeffects);
          console.log('predictedcause:', predictedcause);
          console.log('predictedmedicine:', predictedmedicine);
          console.log('predictedprevention:', predictedprevention);
          console.log('predictedlink:', predictedlink);

          const url = `http://localhost/ML_Project-2023-/teacheable.php?predictedname=${predictedName}&predicteddisease=${predictedDisease}&predicteddescription=${predictedDescription}&predictedeffects=${predictedeffects}&predictedcause=${predictedcause}&predictedmedicine=${predictedmedicine}&predictedprevention=${predictedprevention}&predictedlink=${predictedlink}`;

    fetch(url, { method: 'GET' })
      .then(response => {
        // Handle the response
        console.log('Data inserted successfully!');
      })
      .catch(error => {
        // Handle any errors
        console.error('Error inserting data:', error);
      }); 
    
  }

  // Load image using FileReader
      function loadImage(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => {
            const img = new Image();
    img.onload = () => resolve(tf.browser.fromPixels(img));
    img.onerror = (error) => reject(error);
    img.src = reader.result;
  };
  reader.readAsDataURL(file);
});
}